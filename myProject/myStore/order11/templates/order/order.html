<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>订单页</title>
    {% load static %}
    <link rel="shortcut icon" href="{% static '/order/img/ico/order01.ico' %}">
    <link rel="stylesheet" href="{% static '/order/css/bootstrap.min.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static '/order/css/order.css' %}" type="text/css">
    <script src="{% static '/order/js/jquery.min.js' %}"></script>
</head>
<body>
    <header>
        <div class="headerBar">
            <div id="login1" class="headerText">
                <a href="/index/0">首页</a>
            </div>

            <div id="order1" class="headerText pull-right">
                <a href="#">我的订单</a>
            </div>
            <div id="shopping" class="headerText pull-right">
                <a href="#">购物车</a>
            </div>
        </div>
    </header>

    <nav class="container">
        <div class="row">
            <nav class="col-lg-12 col-md-12 navigationBar">
                <span onclick="showOrders('all')">全部</span>
                <span onclick="showOrders('unpaid')">待支付</span>
                <span onclick="showOrders('over')">已完成</span>
                <span>已取消</span>
            </nav> <!-- class="navigationBar" -->
        </div>

        <div class="row">
            <nav class="col-lg-12 col-md-12 showNav">
                <form action="#" method="post">
                {% csrf_token %}
                <table id="showTable" >
                    <tr class="firstTr">
                        <th id="th1"><input type="checkbox">全选</th>
                        <th id="th2"></th>
                        <th id="th3">商品信息</th>
                        <th id="th4">单价</th>
                        <th id="th5">数量</th>
                        <th id="th6">金额</th>
                        <th id="th7">操作</th>
                    </tr>

                    {% for o in orders %}
                    <tr><td>&nbsp;</td></tr>
                    <tr class="orderTr" id="1">
                        <!--处理订单状态显示-->
                        {% if o.status == "2" %}
                        <td>已完成</td>
                        {% elif o.status == "1" %}
                        <td><input type="checkbox" onclick="createOrder('{{ o.total }}')"></td>
                        {% endif %}
                        <td><img src="/static/indexWeb/img/goods/{{ o.imgPath }}" alt="图片走丢啦"></td>
                        <td>{{ o.name }}</td>
                        <td>￥{{ o.price }}</td>
                        <td>{{ o.count }}</td>
                        <td style="color: red;">{{ o.total }}</td>
                        <td>删除</td>
                    </tr>
                    {% empty %}
                    <script>
                        var notFound = "<h2>这里什么都没有哦,再忙也要买点什么给自己!</h2>";
                        notFound += '<img style="width: 100%;" src="/static/order/img/bgImg/timg.gif" alt="图片走丢啦">';
                        $(".showNav").html(notFound);
                    </script>
                    {% endfor %}

                    
                </table>
                </form>

            </nav> <!-- class="showNav" -->
        </div>

    </nav> <!-- class="container" -->

    <script>
        function showOrders (info){
            $.ajax({
                url: "/order/0",
                type: "post",
                data: {"INFO": info},
                dataType: "json",
                success: function (res) {
                    var htmlStr = "";
                    $.each(res, function (i, order) {
                        htmlStr += "<tr><td>&nbsp;</td></tr>";
                        htmlStr += "<tr class=\"orderTr\" id=\"" + order.id +"\">";
                        if(order.status === "1"){
                            htmlStr += "<td><input type=\"checkbox\" value=\"{{ o.total }}\"></td>";
                        }else if(order.status === "2"){
                            htmlStr += "<td>已完成</td>";
                        }
                        htmlStr += "<td><img src=\"/static/indexWeb/img/goods/"+ order.imgPath + "\" alt=\"图片走丢啦\"></td>";
                        htmlStr += "<td>" + order.name + "</td>";
                        htmlStr += "<td>￥" + order.price + "</td>";
                        htmlStr += "<td>" + order.count + "</td>";
                        htmlStr += "<td style=\"color: red;\">" + order.total + "</td>";
                        htmlStr += "<td>删除1</td>";
                    });
                    $("#showTable tr:not('.firstTr')").html("");
                    $("#showTable").append(htmlStr);
                },
                error: function () {
                    console.log("我错啦")
                },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}")
                },

            });
            console.log(info);
        }
    </script>

    <script>
        function createOrder(id) {
            alert(id);
        }
    </script>
</body>
</html>